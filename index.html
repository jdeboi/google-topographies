<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- maps -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/mappa-mundi/dist/mappa.min.js" type="text/javascript"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <!-- custom CSS -->
  <link rel="stylesheet" href="./css/custom.css" />

  <title>Hidden Topographies of Google</title>
</head>

<body>
  <div id="landingPage">
    <div id="instructions">
      <h2>Instructions</h2>
      <ol>
        <li>Go to <a href="https://takeout.google.com/?pli=1">Google Takeout</a> and download "Location
          History".</li>
        <li>Wait till your download is ready.</li>
        <li>Unzip folder</li>
        <li>Open Takeout > Location History, and upload 'Location History.json' below.</li>
      </ol>

      <input type="file" id="myFile" multiple size="50">
    </div>

  </div>
  <div id="loading">loading...</div>
  <div id="faq">
    <h1>FAQ</h1>
    <p>Move by dragging the mouse</p>
    <p><em>Click</em> on the small navigation map to set the topography visualizer center</p>
  </div>
  <div id="container"></div>
  <div id="navMap"></div>
  <div id="buttons">
    <span><i class="fas fa-info-circle"></i></span>
    <a href="github.com"><i class="fab fa-github"></i></a>
  </div>

  <!-- my scripts -->
  <script src="./js/keys.js"></script>
  <script type="module" src="./js/terrain.js"></script>
  <script type="module" src="./js/MapData.js"></script>
  <script src="https://kit.fontawesome.com/323958fe6d.js" crossorigin="anonymous"></script>

  <!-- bootstrap -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>

  <!-- ---------------- Custom Shader Code ------------------------ -->
  <script id="vertexShader" type="x-shader/x-vertex">
      attribute float displacement;
      varying float vAmount;
      varying vec2 vUV;
      
      void main() 
      { 
        vUV = uv;
        float d = displacement;
        if (d == 0.) {
          d = -.01;
        } else {
          d *= 1.5;
        }
        vAmount = d; 
        vec3 newPosition = position + normal * vec3( d );
            gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );
      }
      </script>

  <!-- fragment shader a.k.a. pixel shader -->
  <script id="fragmentShader" type="x-shader/x-vertex">
      uniform sampler2D oceanTexture;
      uniform sampler2D sandyTexture;
      uniform sampler2D grassTexture;
      uniform sampler2D rockyTexture;
      uniform sampler2D snowyTexture;
    
      varying vec2 vUV;
      varying float vAmount;
      
      void main() 
      {
        float alpha = .3;
    
        vec4 col = vec4(0.0);
        vec3 blue = vec3(0.184, 0.396, 0.914);
        vec3 green = vec3(0.153, 0.584, 0.235);
        vec3 red = vec3(0.82, 0.271, 0.271);
        vec3 yellow = vec3(0.965, 0.686, 0.035);
        vec3 scaler = vec3(alpha);
    
        if (vAmount < 30.) col = vec4(yellow*scaler, alpha);
        else if (vAmount < 50.) col = vec4(yellow*scaler, alpha);
        else if (vAmount < 80.) col = vec4(green*scaler, alpha);
        else col = vec4(blue*scaler, alpha);
    
        float vAmountOG = vAmount/300.0;
        vec4 sandy = (smoothstep(0.0, 0.07, vAmountOG) - smoothstep(0.06, 0.08, vAmountOG)) * texture2D( sandyTexture, vUV * 10.0 );
        vec4 dirt = (smoothstep(0.05, 0.1, vAmountOG) - smoothstep(0.09, 0.11, vAmountOG)) * texture2D( rockyTexture, vUV * 10.0 );
        vec4 grass = (smoothstep(0.0, 0.2, vAmountOG) - smoothstep(0.1, 0.25, vAmountOG)) * texture2D( grassTexture, vUV * 30.0 );
        vec4 rocky = (smoothstep(0.1, 0.50, vAmountOG) - smoothstep(0.40, 0.70, vAmountOG)) * texture2D( rockyTexture, vUV * 20.0 );
        vec4 snowy = (smoothstep(0.50, 0.65, vAmountOG))                                   * texture2D( snowyTexture, vUV * 10.0 );
        vec4 terrain = vec4(0.0, 0.0, 0.0, 1.0-alpha) + sandy + dirt + grass + rocky + snowy; //, 1.0);
        float r = terrain[0]*(1.0-alpha) + col[0];
        float g = terrain[1]*(1.0-alpha) + col[1];
        float b = terrain[2]*(1.0-alpha) + col[2];
        gl_FragColor = vec4(r, g, b, 1.0);
      }  
      </script>

</body>

</html>